1. install
pacman -R ruby
pacman -S gitlab

2. 编辑 /etc/webapps/gitlab/gitlab.yml
	production->gitlab->host

3. 创建数据库
systemctl start mysqld
$ mysql -u root -p
mysql> CREATE DATABASE `gitlabhq_production` DEFAULT CHARACTER SET `utf8` COLLATE `utf8_unicode_ci`;
mysql> CREATE USER 'gitlab'@'localhost' IDENTIFIED BY 'secure password';
mysql> GRANT ALL ON `gitlabhq_production`.* TO 'gitlab'@'localhost';
mysql> \q

# 修改密码用
# SET PASSWORD FOR 'gitlab'@'localhost' = PASSWORD('secure password')

4. 测试连接数据库是否正常：
mysql -u gitlab -p -D gitlabhq_production
# 输入上一步中设置的密码

5. 配置数据库
cp /usr/share/doc/gitlab/database.yml.mysql /etc/webapps/gitlab/database.yml
# 检查其中的用户名和密码是否跟第 3 步中的一致
# chmod 600 /etc/webapps/gitlab/database.yml
# chown gitlab:gitlab /etc/webapps/gitlab/database.yml

6. 配置 redis
编辑 /etc/redis.conf
	unixsocket /var/run/redis/redis.sock
	unixsocketperm 777
编辑 /etc/webapps/gitlab/gitlab.yml
	socket: /var/run/redis/redis.sock

7. 启动 redis
systemctl start redis

8. 生成 secret
# hexdump -v -n 64 -e '1/1 "%02x"' /dev/urandom > /etc/webapps/gitlab-shell/secret
# chown root:gitlab /etc/webapps/gitlab-shell/secret
# chmod 640 /etc/webapps/gitlab-shell/secret
# hexdump -v -n 64 -e '1/1 "%02x"' /dev/urandom > /etc/webapps/gitlab/secret
# chown root:gitlab /etc/webapps/gitlab/secret
# chmod 640 /etc/webapps/gitlab/secret

9. 修改权限
sudo chmod 700 /var/lib/gitlab/uploads
sudo usermod -a -G redis git
sudo usermod -a -G redis gitlab
sudo -u gitlab -H "/usr/bin/git" config --global core.autocrlf "input"

10. 初始化数据库
su - gitlab -s /bin/sh -c "cd '/usr/share/webapps/gitlab'; bundle-2.3 exec rake gitlab:setup RAILS_ENV=production"

9. 检查
su - gitlab -s /bin/sh -c "PATH=/opt/ruby2.3/bin:/opt/ruby2.3/lib/ruby/gems/2.3.0/bin:$PATH; cd '/usr/share/webapps/gitlab'; bundle-2.3 exec rake gitlab:env:info RAILS_ENV=production"

su - gitlab -s /bin/sh -c "PATH=/opt/ruby2.3/bin:/opt/ruby2.3/lib/ruby/gems/2.3.0/bin:$PATH; cd '/usr/share/webapps/gitlab'; bundle-2.3 exec rake gitlab:check RAILS_ENV=production"

10. http
编辑 /etc/httpd/conf/httpd.conf
	LoadModule ****
	Include /etc/httpd/conf/extra/gitlab.conf
配置
	cp /usr/share/doc/gitlab/apache.conf.example /etc/httpd/conf/extra/gitlab.conf
	编辑
		替换 YOUR_SERVER_FQDN 为 第 2 步中的 host
配置 gitlab-workhorse.service
	使用 8181 tcp
